import{z as t}from"../_/index.mjs";import{S as e,s,n as r,f as i,r as n,a as u,g as o,c as a,u as c,b as h}from"./server.mjs";import{m as l,i as d,c as p,r as f,w as y,J as R,K as v,L as m,d as Q,j as b,M as O,H as g,N as S,u as I}from"../routes/renderer.mjs";import"../runtime.mjs";var w=class extends e{constructor(t,e){super(),this.options=e,this.#t=t,this.#e=null,this.bindMethods(),this.setOptions(e)}#t;#s=void 0;#r=void 0;#i=void 0;#n;#u;#e;#o;#a;#c;#h;#l;#d;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){1===this.listeners.size&&(this.#s.addObserver(this),shouldFetchOnMount(this.#s,this.options)?this.#f():this.updateResult(),this.#y())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return shouldFetchOn(this.#s,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return shouldFetchOn(this.#s,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#R(),this.#v(),this.#s.removeObserver(this)}setOptions(t,e){const r=this.options,i=this.#s;if(this.options=this.#t.defaultQueryOptions(t),void 0!==this.options.enabled&&"boolean"!=typeof this.options.enabled)throw new Error("Expected enabled to be a boolean");this.#m(),this.#s.setOptions(this.options),r._defaulted&&!s(this.options,r)&&this.#t.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#s,observer:this});const n=this.hasListeners();n&&shouldFetchOptionally(this.#s,i,this.options,r)&&this.#f(),this.updateResult(e),!n||this.#s===i&&this.options.enabled===r.enabled&&this.options.staleTime===r.staleTime||this.#Q();const u=this.#b();!n||this.#s===i&&this.options.enabled===r.enabled&&u===this.#d||this.#O(u)}getOptimisticResult(t){const e=this.#t.getQueryCache().build(this.#t,t),r=this.createResult(e,t);return function(t,e){if(!s(t.getCurrentResult(),e))return!0;return!1}(this,r)&&(this.#i=r,this.#u=this.options,this.#n=this.#s.state),r}getCurrentResult(){return this.#i}trackResult(t,e){const s={};return Object.keys(t).forEach((r=>{Object.defineProperty(s,r,{configurable:!1,enumerable:!0,get:()=>(this.trackProp(r),e?.(r),t[r])})})),s}trackProp(t){this.#p.add(t)}getCurrentQuery(){return this.#s}refetch({...t}={}){return this.fetch({...t})}fetchOptimistic(t){const e=this.#t.defaultQueryOptions(t),s=this.#t.getQueryCache().build(this.#t,e);return s.isFetchingOptimistic=!0,s.fetch().then((()=>this.createResult(s,e)))}fetch(t){return this.#f({...t,cancelRefetch:t.cancelRefetch??!0}).then((()=>(this.updateResult(),this.#i)))}#f(t){this.#m();let e=this.#s.fetch(this.options,t);return t?.throwOnError||(e=e.catch(r)),e}#Q(){this.#R()}#b(){return("function"==typeof this.options.refetchInterval?this.options.refetchInterval(this.#s):this.options.refetchInterval)??!1}#O(t){this.#v(),this.#d=t}#y(){this.#Q(),this.#O(this.#b())}#R(){this.#h&&(clearTimeout(this.#h),this.#h=void 0)}#v(){this.#l&&(clearInterval(this.#l),this.#l=void 0)}createResult(t,e){const s=this.#s,r=this.options,u=this.#i,o=this.#n,a=this.#u,c=t!==s?t.state:this.#r,{state:h}=t;let l,d={...h},p=!1;if(e._optimisticResults){const n=this.hasListeners(),u=!n&&shouldFetchOnMount(t,e),o=n&&shouldFetchOptionally(t,s,e,r);(u||o)&&(d={...d,...i(h.data,t.options)}),"isRestoring"===e._optimisticResults&&(d.fetchStatus="idle")}let{error:f,errorUpdatedAt:y,status:R}=d;if(e.select&&void 0!==d.data)if(u&&d.data===o?.data&&e.select===this.#o)l=this.#a;else try{this.#o=e.select,l=e.select(d.data),l=n(u?.data,l,e),this.#a=l,this.#e=null}catch(t){this.#e=t}else l=d.data;if(void 0!==e.placeholderData&&void 0===l&&"pending"===R){let t;if(u?.isPlaceholderData&&e.placeholderData===a?.placeholderData)t=u.data;else if(t="function"==typeof e.placeholderData?e.placeholderData(this.#c?.state.data,this.#c):e.placeholderData,e.select&&void 0!==t)try{t=e.select(t),this.#e=null}catch(t){this.#e=t}void 0!==t&&(R="success",l=n(u?.data,t,e),p=!0)}this.#e&&(f=this.#e,l=this.#a,y=Date.now(),R="error");const v="fetching"===d.fetchStatus,m="pending"===R,Q="error"===R,b=m&&v,O=void 0!==l;return{status:R,fetchStatus:d.fetchStatus,isPending:m,isSuccess:"success"===R,isError:Q,isInitialLoading:b,isLoading:b,data:l,dataUpdatedAt:d.dataUpdatedAt,error:f,errorUpdatedAt:y,failureCount:d.fetchFailureCount,failureReason:d.fetchFailureReason,errorUpdateCount:d.errorUpdateCount,isFetched:d.dataUpdateCount>0||d.errorUpdateCount>0,isFetchedAfterMount:d.dataUpdateCount>c.dataUpdateCount||d.errorUpdateCount>c.errorUpdateCount,isFetching:v,isRefetching:v&&!m,isLoadingError:Q&&!O,isPaused:"paused"===d.fetchStatus,isPlaceholderData:p,isRefetchError:Q&&O,isStale:isStale(t,e),refetch:this.refetch}}updateResult(t){const e=this.#i,r=this.createResult(this.#s,this.options);if(this.#n=this.#s.state,this.#u=this.options,void 0!==this.#n.data&&(this.#c=this.#s),s(r,e))return;this.#i=r;const i={};!1!==t?.listeners&&(()=>{if(!e)return!0;const{notifyOnChangeProps:t}=this.options,s="function"==typeof t?t():t;if("all"===s||!s&&!this.#p.size)return!0;const r=new Set(s??this.#p);return this.options.throwOnError&&r.add("error"),Object.keys(this.#i).some((t=>{const s=t;return this.#i[s]!==e[s]&&r.has(s)}))})()&&(i.listeners=!0),this.#g({...i,...t})}#m(){const t=this.#t.getQueryCache().build(this.#t,this.options);if(t===this.#s)return;const e=this.#s;this.#s=t,this.#r=t.state,this.hasListeners()&&(e?.removeObserver(this),t.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#y()}#g(t){u.batch((()=>{t.listeners&&this.listeners.forEach((t=>{t(this.#i)})),this.#t.getQueryCache().notify({query:this.#s,type:"observerResultsUpdated"})}))}};function shouldFetchOnMount(t,e){return function(t,e){return!1!==e.enabled&&void 0===t.state.data&&!("error"===t.state.status&&!1===e.retryOnMount)}(t,e)||void 0!==t.state.data&&shouldFetchOn(t,e,e.refetchOnMount)}function shouldFetchOn(t,e,s){if(!1!==e.enabled){const r="function"==typeof s?s(t):s;return"always"===r||!1!==r&&isStale(t,e)}return!1}function shouldFetchOptionally(t,e,s,r){return(t!==e||!1===r.enabled)&&(!s.suspense||"error"!==t.state.status)&&isStale(t,s)}function isStale(t,e){return!1!==e.enabled&&t.isStaleByTime(e.staleTime)}function useBaseQuery(t,e,s){const r=function(t=""){if(!l())throw new Error("vue-query hooks can only be used inside setup() function or functions that support injection context.");const e=o(t),s=d(e);if(!s)throw new Error("No 'queryClient' found in Vue context, use 'VueQueryPlugin' to properly initialize the library.");return s}(),i=p((()=>{const t=a(e);"function"==typeof t.enabled&&(t.enabled=t.enabled());const s=r.defaultQueryOptions(t);return s._optimisticResults=r.isRestoring.value?"isRestoring":"optimistic",s})),n=new t(r,i.value),u=f(n.getCurrentResult());let unsubscribe=()=>{};y(r.isRestoring,(t=>{t||(unsubscribe(),unsubscribe=n.subscribe((t=>{c(u,t)})))}),{immediate:!0});const updater=()=>{n.setOptions(i.value),c(u,n.getCurrentResult())};y(i,updater),R((()=>{unsubscribe()}));y((()=>u.error),(t=>{if(u.isError&&!u.isFetching&&h(i.value.throwOnError,[t,n.getCurrentQuery()]))throw t}));const Q=v(m(u));for(const t in u)"function"==typeof u[t]&&(Q[t]=u[t]);return Q.suspense=()=>new Promise(((t,e)=>{let stopWatch=()=>{};const run=()=>{if(!1!==i.value.enabled){n.setOptions(i.value);const s=n.getOptimisticResult(i.value);s.isStale?(stopWatch(),n.fetchOptimistic(i.value).then(t,(s=>{h(i.value.throwOnError,[s,n.getCurrentQuery()])?e(s):t(n.getCurrentResult())}))):(stopWatch(),t(s))}};run(),stopWatch=y(i,run)})),Q.refetch=(...t)=>(updater(),u.refetch(...t)),Q}const F=Q({__name:"index",__ssrInlineRender:!0,async setup(e){let s,r;const i=t.object({hello:t.string(),id:t.string()}),{data:n,error:u,suspense:o}=useBaseQuery(w,{queryKey:["ul","info"],queryFn:async()=>{const t=await $fetch("https://api.1clicom.ru/expert/?tenders&d",{method:"POST",body:{hello:"world new"}}),{success:e,data:s}=i.safeParse(t);if(!e)throw new Error("Error");return s},retry:!1});return[s,r]=O((()=>o())),await s,r(),(t,e,s,r)=>{e(`<div${g(r)}><h1 class="text-2xl">Hello world</h1><div class="flex flex-col"><pre>Data - ${S(I(n))}</pre><pre>Error - ${S(I(u))}</pre></div></div>`)}}}),C=F.setup;F.setup=(t,e)=>{const s=b();return(s.modules||(s.modules=new Set)).add("pages/index.vue"),C?C(t,e):void 0};export{F as default};
//# sourceMappingURL=index-B3mVKm4o.mjs.map
